---
title: "Análisis de la administración del personal - primera fase"
subtitle: "SIAP - IMSS"
---

**Tipo de plantilla:** {{< meta tipo_plantilla >}}

**Quincena:** {{< meta quincena >}}

**Responsable:** {{< meta pers_1 >}}

**Contacto:** {{< meta contacto_1 >}}

**Fecha de generación:** `r format(Sys.time(), "%d/%m/%Y %H:%M")`


<!-- Preamble, note that R code gets executed first, so ```{=latex}```, might not follow the order set in the qmd file here -->

<!-- Should be in preamble.tex but not working: -->
\renewcommand{\listfigurename}{Lista de Figuras}
\renewcommand{\listtablename}{Lista de Tablas}

<!-- Setup: -->
\newpage
\tableofcontents
\listoffigures
\listoftables

<!-- Location of this qmd script is where results are -->
<!-- eg "~/Documents/work/comp_med_medicina_datos/projects/int_op/oferta_educativa_laboral/documents/reports/reporte_oferta_laboral_04022025/select_results/22_11_2024_2_clean_dups_col_types_Qna_17_Plantilla_2024/to_include" -->

<!-- Globals: -->
```{r, echo = FALSE}
options(knitr.table.format = "latex",
        knitr.table.digits = 2) # avoids having to write format = "latex" in each kable() call
```

<!-- Setup libraries for qmd, location not needed if running as a pipeline. -->
```{r, echo = FALSE}
library(magrittr)  # pipes
library(knitr)
library(kableExtra)  # additional table formatting
```

```{r, echo = FALSE}
# # Define a function to apply consistent styling to all tables
# epi_table_kable_format <- function(kable_input) {
#   kable_input %>%
#     kableExtra::kable_styling(
#       latex_options = c("striped", "hold_position", "scale_down"), # Alternating row colors, better positioning, auto-resize
#       # font_size = 9,  # Slightly smaller font for a professional look
#       full_width = FALSE,  # Keeps tables neatly centered
#       position = "center"  # Centers the table on the page
#     ) %>%
#     column_spec(1, bold = TRUE) %>%  # Bold first column for readability
#     row_spec(0, bold = TRUE, background = "#D3D3D3")  # Bold header with light gray background
# }

# Function to apply consistent styling to tables
epi_table_kable_format <- function(kable_input,
                                   longtable = FALSE,
                                   font = NULL,
                                   full_width = FALSE,
                                   position = 'center') {
  if (longtable) {
    # # Extract caption dynamically
    # caption_text <- attr(kable_input, "caption")
    # if (is.null(caption_text)) {
    #   caption_text <- ""  # Avoid NULL captions
    # }
    return(
      kable_input %>%
        kable_styling(
          latex_options = c("repeat_header", "striped", "hold_position"),
          full_width = full_width,
          position = position
        )) %>%
        column_spec(1, bold = TRUE) %>%
        row_spec(0, bold = TRUE, background = "#D3D3D3")
    } else {
    return(
      kable_input %>%
        kable_styling(
          latex_options = c("striped", "hold_position", "scale_down"),  # Ensures proper placement & auto-resize
          full_width = full_width,
          position = position
        ) %>%
        column_spec(1, bold = TRUE) %>%
        row_spec(0, bold = TRUE, background = "#D3D3D3")
    )
  }
}
```

\newpage

## 1_totales

<!-- TO DO: Move all to QC appendix -->
3b_skim_summary.html
sum_stats.txt
desc_dates.txt

```{r, sum_stats, echo = FALSE, results = "asis"}
table_to_pdf <- "sum_stats.txt"
table_to_pdf <- read.table(table_to_pdf, header = TRUE, sep = "\t")
caption <- "Resumen de variables numéricas"

# Create LaTeX table:
table_to_latex <- knitr::kable(table_to_pdf, caption = caption, booktabs = TRUE) %>%
    epi_table_kable_format(longtable = FALSE)

# Ensure Quarto recognizes the table:
knitr::asis_output(table_to_latex)
```

<!-- TO DO does not work -->
<!-- Multiple tries -->
<!-- Checking whether e.g. @tbl-sum_stats cross referencing works -->

\clearpage

## 2_sociodemo

![Histograma de Edad](plots_hist_num_1.pdf)

![Diagrama de cajas de Edad](plots_box_num_1.pdf)

![Gráfico de barras por Género](plots_bar_9 copy 2.pdf)

![Gráfico de barras por Escolaridad](plots_bar_29.pdf)

```{r, escolaridad, echo = FALSE, results = "asis"}
table_to_pdf <- "table_PLZOCU_ESCOLARIDAD.txt"
table_to_pdf <- read.table(table_to_pdf, header = TRUE, sep = "\t")
caption <- "Plazas ocupadas por Escolaridad"

table_to_latex <- knitr::kable(table_to_pdf, caption = caption, booktabs = TRUE) %>%
    epi_table_kable_format(longtable = FALSE)

knitr::asis_output(table_to_latex)
```

\clearpage

## 2a_persona_en_plaza

![Histogramas de Fecha de inicio y término](plots_hist_dates_5.pdf)

![Histograma de Antigüedad en días](plots_hist_num_1 copy 2.pdf)

![Diagrama de caja de Antigüedad en días](plots_box_num_1 copy.pdf)

![Histograma de Fecha de primer confianza](plots_hist_dates_9.pdf)

![Histograma de Fecha de nominación](plots_hist_dates_5 copy 2.pdf)

![Gráfico de barras por Comisión sindical](plots_bar_21_copy.pdf){width=70%}

```{r, COMSIN, echo = FALSE, results = "asis"}
table_to_pdf <- "table_PLZOCU_COMSIN.txt"
table_to_pdf <- read.table(table_to_pdf, header = TRUE, sep = "\t")
caption <- "Plazas ocupadas por Comisión sindical"

table_to_latex <- knitr::kable(table_to_pdf, caption = caption, booktabs = TRUE) %>%
    epi_table_kable_format(longtable = FALSE)

knitr::asis_output(table_to_latex)
```

\clearpage

## 3_lugares

![Gráficos de barras por Delegación y Unidad](plots_bar_1.pdf)

```{r, DELEGACION, echo = FALSE, results = "asis"}
# table_to_pdf <- "1_totales/sum_stats.txt"
table_to_pdf <- "table_PLZOCU_DELEGACION.txt"
table_to_pdf <- read.table(table_to_pdf, header = TRUE, sep = "\t")
caption <- "Plazas ocupadas por Delegación"

table_to_latex <- knitr::kable(table_to_pdf, caption = caption, booktabs = TRUE) %>%
    epi_table_kable_format(longtable = FALSE)

knitr::asis_output(table_to_latex)
```


\clearpage

<!-- TO DO: Move to QC appendix -->

```{r, PLZOCU_DESCRIP_LOCALIDAD, echo = FALSE, results = "asis"}
table_to_pdf <- "table_PLZOCU_DESCRIP_LOCALIDAD.txt"
table_to_pdf <- read.table(table_to_pdf, header = TRUE, sep = "\t")
caption <- "Plazas ocupadas por Localidad"

table_to_latex <- knitr::kable(table_to_pdf, caption = caption, booktabs = TRUE,
                              longtable = TRUE) %>%
    epi_table_kable_format(longtable = TRUE)

knitr::asis_output(table_to_latex)
```

\clearpage

<!-- TO DO: continue here -->

## 4_plaza_desc

![DESCRIP_CLASCATEG](plots_bar_9.pdf)

table_PLZOCU_DESCRIP_CLASCATEG.txt

table_PLZOCU_CLASIF_UNIDAD.txt

<!-- plots_hist_dates_1.pdf [FECHAING, FECHAMOV, FECHAOCUP, FECHALIMOCU] -->

<!-- table_PLZOCU_NOMBREAR.txt -->
<!-- table_PLZOCU_ADSCRIPCION.txt -->
<!-- table_PLZOCU_CATEGORIA.txt -->
<!-- table_PLZOCU_ULTIMACATEGBASE.txt -->
<!-- table_PLZOCU_DESCRIPCION_SERVICIO.txt -->

<!-- table_PLZOCU_DEPENDENCIA.txt -->

<!-- plots_bar_5.pdf [DescripcionTC] -->
<!-- table_PLZOCU_DescripcionTC.txt -->

<!-- plots_bar_13.pdf [TipoConfianza, GrupoTipoPlaza] -->
<!-- table_PLZOCU_TipoConfianza.txt -->
<!-- table_PLZOCU_GrupoTipoPlaza.txt -->

<!-- plots_bar_13 copy.pdf [DESCRIP_TIPO_DE_PLAZA] -->
<!-- table_PLZOCU_DESCRIP_TIPO_DE_PLAZA.txt -->

<!-- plots_bar_17 copy.pdf [TipoMcaOcup] -->
<!-- table_PLZOCU_TipoMcaOcup.txt -->
<!-- table_PLZOCU_MCP.txt -->

<!-- plots_bar_17 copy 2.pdf [PLZAUT, PLZOCU] -->
<!-- table_PLZOCU_PLZAUT.txt -->

<!-- plots_bar_21.pdf [PLZSOB, PTO] -->
<!-- table_PLZOCU_PLZSOB.txt -->
<!-- table_PLZOCU_PTO.txt -->

<!-- plots_bar_29 copy.pdf [VIGENCIAPTO] -->
<!-- table_PLZOCU_VIGENCIAPTO.txt -->

<!-- plots_bar_9 copy.pdf [PLZOCU_DESCRIP_TURNO] -->
<!-- table_PLZOCU_DESCRIP_TURNO.txt -->
<!-- table_PLZOCU_DESCRIP_HORARIO.txt -->

<!-- table_PLZOCU_DATOADIC_CATBASE.txt -->


<!-- \clearpage -->

<!-- ## 5_bajas_jubilaciones -->

<!-- plots_hist_dates_5 copy.pdf [FECHAPROBJUB] -->

<!-- plots_bar_25 copy 2.pdf [JUBILA] -->
<!-- table_PLZOCU_JUBILA.txt -->

<!-- plots_bar_17.pdf [MCABAJA] -->
<!-- table_PLZOCU_MCABAJA.txt -->

<!-- plots_bar_25 copy.pdf [MY, RJP] -->
<!-- table_PLZOCU_MY.txt -->
<!-- table_PLZOCU_RJP.txt -->


<!-- \clearpage -->

<!-- ## 6_finanzas -->

<!-- ![CPTO180](plots_bar_25.pdf) -->
<!-- table_PLZOCU_CPTO180.txt -->

<!-- ![IMP_035, IMP_037, IMP_SDO, FALTASACUMULADAS](plots_hist_num_5.pdf) -->
<!-- ![IMP_035, IMP_037, IMP_SDO, FALTASACUMULADAS](plots_box_num_5.pdf) -->

<!-- ![IMP_010, IMP_024](plots_hist_num_1 copy.pdf) -->
<!-- ![IMP_010, IMP_024](plots_box_num_1 copy 2.pdf) -->
