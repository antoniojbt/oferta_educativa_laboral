---
title: "Análisis de la administración del personal - primera fase"
subtitle: "SIAP - IMSS"
---

**Tipo de plantilla:** {{< meta tipo_plantilla >}}

**Quincena:** {{< meta quincena >}}

**Responsable:** {{< meta pers_1 >}}

**Contacto:** {{< meta contacto_1 >}}

**Fecha de generación:** `r format(Sys.time(), "%d/%m/%Y %H:%M")`


<!-- Preamble, note that R code gets executed first, so ```{=latex}```, might not follow the order set in the qmd file here -->

<!-- Should be in preamble.tex but not working: -->
\renewcommand{\listfigurename}{Lista de Figuras}
\renewcommand{\listtablename}{Lista de Tablas}

<!-- Setup: -->
\newpage
\tableofcontents
\listoffigures
\listoftables

<!-- Location of this qmd script is where results are -->
<!-- eg "~/Documents/work/comp_med_medicina_datos/projects/int_op/oferta_educativa_laboral/documents/reports/reporte_oferta_laboral_04022025/select_results/22_11_2024_2_clean_dups_col_types_Qna_17_Plantilla_2024/to_include" -->

<!-- Setup libraries for qmd, location not needed if running as a pipeline. -->
```{r, echo = FALSE}
library(magrittr)  # pipes
library(knitr)
library(kableExtra)  # additional table formatting
```

```{r, echo = FALSE}
epi_table_to_latex <- function(file_path,
                               caption,
                               sep = "\t",
                               header = TRUE,
                               format = "latex",
                               digits = 2,
                               booktabs = TRUE,
                               longtable = FALSE, # epi_table_kable_format var
                               font_size = NULL, # epi_table_kable_format var
                               full_width = FALSE, # epi_table_kable_format var
                               position = 'center', # epi_table_kable_format var
                               align = "c", # Allows column alignment customization
                               repeat_header_text = "\\textit{(continuada)}"
                               ) {
    # Load a table from a file (.txt format with tab-separated values).
    # Apply formatting using kable() and epi_table_kable_format().
    # Return a LaTeX-formatted table that Quarto can handle.
    
    # Check if file exists before reading
    if (!file.exists(file_path)) {
        warning(paste("File", file_path, "not found."))
        return(knitr::asis_output("\\textbf{Table not found}"))
    }
    
    # Read table from file:
    table_data <- tryCatch({
        read.table(file_path, header = header, sep = sep)
    }, error = function(e) {
        error(paste("Error reading table:", file_path))
        return(NULL)
    })
    
    # Handle case where table is empty
    if (is.null(table_data) || nrow(table_data) == 0) {
        error("Table is empty.")
        return(knitr::asis_output("\\textbf{Table is empty}"))
    }
    
    # Create formatted LaTeX table:
    table_to_latex <- knitr::kable(
        table_data,
        caption = caption, 
        booktabs = booktabs,
        longtable = longtable,
        format = format,
        digits = digits,
        align = align # column alignment
    ) %>%
        epi_table_kable_format(longtable = longtable,
                               font_size = font_size,
                               full_width = full_width,
                               position = position,
                               repeat_header_text = repeat_header_text
        )

    # Output LaTeX for Quarto PDF conversion:
    knitr::asis_output(table_to_latex)
}
```

```{r, echo = FALSE}
# Function to apply consistent styling to tables
epi_table_kable_format <- function(kable_input,
                                   longtable = FALSE,
                                   font_size = NULL,
                                   full_width = FALSE,
                                   position = 'center',
                                   repeat_header_text = repeat_header_text
                                   ) {
    if (longtable) {
        kable_input <- kable_input %>%
            kable_styling(
                latex_options = c("repeat_header", "striped", "hold_position"),
                full_width = full_width,
                position = position,
                repeat_header_text = repeat_header_text,
                font_size = font_size
            ) %>%
            column_spec(1, bold = TRUE) %>%
            row_spec(0, bold = TRUE, background = "#D3D3D3")
    } else {
        kable_input <- kable_input %>%
            kable_styling(
                latex_options = c("striped", "hold_position", "scale_down"),  # Ensures proper placement & auto-resize
                full_width = full_width,
                position = position,
                repeat_header_text = repeat_header_text,
                font_size = font_size
            ) %>%
            column_spec(1, bold = TRUE) %>%
            row_spec(0, bold = TRUE, background = "#D3D3D3")
    }
    
    return(kable_input)
}

```

\newpage

## 1_totales

<!-- TO DO: Move all to QC appendix -->
3b_skim_summary.html
sum_stats.txt
desc_dates.txt

```{r, sum_stats, echo = FALSE, results = "asis"}
epi_table_to_latex("sum_stats.txt",
                   "Resumen de variables numéricas"
                   )
```

<!-- TO DO does not work -->
<!-- Multiple tries -->
<!-- Checking whether e.g. @tbl-sum_stats cross referencing works -->

\clearpage

## 2_sociodemo

![Histograma de Edad](plots_hist_num_1.pdf)

![Diagrama de cajas de Edad](plots_box_num_1.pdf)

![Gráfico de barras por Género](plots_bar_9 copy 2.pdf)

![Gráfico de barras por Escolaridad](plots_bar_29.pdf)

```{r, table_PLZOCU_ESCOLARIDAD, echo = FALSE, results = "asis"}
epi_table_to_latex("table_PLZOCU_ESCOLARIDAD.txt",
                   "Plazas ocupadas por Escolaridad"
                   )
```

\clearpage

## 2a_persona_en_plaza

![Histogramas de Fecha de inicio y término](plots_hist_dates_5.pdf)

![Histograma de Antigüedad en días](plots_hist_num_1 copy 2.pdf)

![Diagrama de caja de Antigüedad en días](plots_box_num_1 copy.pdf)

![Histograma de Fecha de primer confianza](plots_hist_dates_9.pdf)

![Histograma de Fecha de nominación](plots_hist_dates_5 copy 2.pdf)

![Gráfico de barras por Comisión sindical](plots_bar_21_copy.pdf){width=70%}

```{r, table_PLZOCU_COMSIN, echo = FALSE, results = "asis"}
epi_table_to_latex("table_PLZOCU_COMSIN.txt",
                   "Plazas ocupadas por Comisión sindical"
                   )
```

\clearpage

## 3_lugares

![Gráficos de barras por Delegación y Unidad](plots_bar_1.pdf)

```{r, table_PLZOCU_DELEGACION, echo = FALSE, results = "asis"}
# table_to_pdf <- "1_totales/sum_stats.txt"
epi_table_to_latex("table_PLZOCU_DELEGACION.txt",
                   "Plazas ocupadas por Delegación"
                   )
```

\clearpage

<!-- TO DO: Move to QC appendix -->
<!-- TO DO: Code here for top and bottom, plus any highlights -->

```{r, table_PLZOCU_DESCRIP_LOCALIDAD, echo = FALSE, results = "asis"}
epi_table_to_latex("table_PLZOCU_DESCRIP_LOCALIDAD.txt",
                   "Plazas ocupadas por Localidad",
                   longtable = TRUE,
                   font_size = 9
                   )
```

\clearpage

## 4_plaza_desc

![Gráfico de barras de Clasificación por Categoría](plots_bar_9.pdf)

```{r, table_PLZOCU_DESCRIP_CLASCATEG, echo = FALSE, results = "asis"}
epi_table_to_latex("table_PLZOCU_DESCRIP_CLASCATEG.txt",
                   "Plazas ocupadas de acuerdo a Clasificación por Categoría"
                   )
```


```{r, table_PLZOCU_CLASIF_UNIDAD, echo = FALSE, results = "asis"}
epi_table_to_latex("table_PLZOCU_CLASIF_UNIDAD.txt",
                   "Plazas ocupadas de acuerdo a Clasificación por Unidad"
                   )
```

\clearpage

### Fechas de movimiento por plaza

![Fechas de movimiento por plaza](plots_hist_dates_1.pdf){width=60%}

\clearpage

<!-- TO DO: Move to QC appendix -->
<!-- TO DO: Code here for top and bottom, plus any highlights -->

```{r, table_PLZOCU_NOMBREAR, echo = FALSE, results = "asis"}
epi_table_to_latex("table_PLZOCU_NOMBREAR.txt",
                   "Plazas ocupadas de acuerdo al Área de Responsabilidad",
                   longtable = TRUE,
                   font_size = 9
                   )
```

\clearpage

<!-- TO DO: Move to QC appendix -->
<!-- TO DO: Code here for top and bottom, plus any highlights -->

```{r, table_PLZOCU_ADSCRIPCION, echo = FALSE, results = "asis"}
epi_table_to_latex("table_PLZOCU_ADSCRIPCION.txt",
                   "Plazas ocupadas de acuerdo a Adscripción",
                   longtable = TRUE,
                   font_size = 9
                   )
```

<!-- TO DO: Move to QC appendix -->
<!-- TO DO: Code here for top and bottom, plus any highlights -->

```{r, table_PLZOCU_CATEGORIA, echo = FALSE, results = "asis"}
epi_table_to_latex("table_PLZOCU_CATEGORIA.txt",
                   "Plazas ocupadas de acuerdo a Categoría",
                   longtable = TRUE,
                   font_size = 9
                   )
```

<!-- TO DO: continue here -->

<!-- ```{r, table_PLZOCU_ULTIMACATEGBASE, echo = FALSE, results = "asis"} -->
<!-- epi_table_to_latex("table_PLZOCU_ULTIMACATEGBASE.txt", -->
<!--                    "Plazas ocupadas de acuerdo a la última Categoría de Base" -->
<!--                    ) -->
<!-- ``` -->

<!-- ```{r, table_PLZOCU_DESCRIPCION_SERVICIO, echo = FALSE, results = "asis"} -->
<!-- epi_table_to_latex("table_PLZOCU_DESCRIPCION_SERVICIO.txt", -->
<!--                    "Plazas ocupadas de acuerdo al Servicio" -->
<!--                    ) -->
<!-- ``` -->

<!-- ```{r, table_PLZOCU_DEPENDENCIA, echo = FALSE, results = "asis"} -->
<!-- epi_table_to_latex("table_PLZOCU_DEPENDENCIA.txt", -->
<!--                    "Plazas ocupadas de acuerdo a la Dependencia" -->
<!--                    ) -->
<!-- ``` -->

\clearpage

![DescripcionTC](plots_bar_5.pdf)
<!-- table_PLZOCU_DescripcionTC.txt -->

![TipoConfianza, GrupoTipoPlaza](plots_bar_13.pdf) 
<!-- table_PLZOCU_TipoConfianza.txt -->
<!-- table_PLZOCU_GrupoTipoPlaza.txt -->

![DESCRIP_TIPO_DE_PLAZA](plots_bar_13 copy.pdf) 
<!-- table_PLZOCU_DESCRIP_TIPO_DE_PLAZA.txt -->

![TipoMcaOcup](plots_bar_17 copy.pdf)
<!-- table_PLZOCU_TipoMcaOcup.txt -->
<!-- table_PLZOCU_MCP.txt -->

![PLZAUT, PLZOCU](plots_bar_17 copy 2.pdf)
<!-- table_PLZOCU_PLZAUT.txt -->

![PLZSOB, PTO](plots_bar_21.pdf)
<!-- table_PLZOCU_PLZSOB.txt -->
<!-- table_PLZOCU_PTO.txt -->

![VIGENCIAPTO](plots_bar_29 copy.pdf)
<!-- table_PLZOCU_VIGENCIAPTO.txt -->

![PLZOCU_DESCRIP_TURNO](plots_bar_9 copy.pdf)
<!-- table_PLZOCU_DESCRIP_TURNO.txt -->
<!-- table_PLZOCU_DESCRIP_HORARIO.txt -->

<!-- table_PLZOCU_DATOADIC_CATBASE.txt -->


\clearpage

## 5_bajas_jubilaciones

<!-- plots_hist_dates_5 copy.pdf [FECHAPROBJUB] -->

<!-- plots_bar_25 copy 2.pdf [JUBILA] -->
<!-- table_PLZOCU_JUBILA.txt -->

<!-- plots_bar_17.pdf [MCABAJA] -->
<!-- table_PLZOCU_MCABAJA.txt -->

<!-- plots_bar_25 copy.pdf [MY, RJP] -->
<!-- table_PLZOCU_MY.txt -->
<!-- table_PLZOCU_RJP.txt -->


<!-- \clearpage -->

<!-- ## 6_finanzas -->

<!-- ![CPTO180](plots_bar_25.pdf) -->
<!-- table_PLZOCU_CPTO180.txt -->

<!-- ![IMP_035, IMP_037, IMP_SDO, FALTASACUMULADAS](plots_hist_num_5.pdf) -->
<!-- ![IMP_035, IMP_037, IMP_SDO, FALTASACUMULADAS](plots_box_num_5.pdf) -->

<!-- ![IMP_010, IMP_024](plots_hist_num_1 copy.pdf) -->
<!-- ![IMP_010, IMP_024](plots_box_num_1 copy 2.pdf) -->
